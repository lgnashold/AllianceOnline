<!doctype html>
<html>
  <head>
    <title> Alliance -- Join Game </title>
    <link rel = "stylesheet" href = "{{ url_for('static', filename='style.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.dev.js"> </script>

  </head>
  <body>
    <div id = "info">
    <div style = "float: right">
    <button  onclick = "startGame()"> Start Game </button>
    <button  onclick = "endTurn()"> End Turn </button>
    <p>
      <button style = " width: 50px; height: 50px; background-color: {{team_colors.team1}}" onclick = "change_team('team1')">Join</button>
      <button style = " width: 50px; height: 50px; background-color: {{team_colors.team2}}" onclick = "change_team('team2')">Join</button>
      <button style = "width: 50px; height: 50px; background-color: {{team_colors.team3}}" onclick = "change_team('team3')">Join</button>
      <button style = "width: 50px; height: 50px;background-color: {{team_colors.team4}}" onclick = "change_team('team4')">Join</button>
    </div>
    </p>

    <h1> Play Alliance </h1>
    <p> <b> Room: </b> {{join_code}} </p>
    <p> <b> Players: </b> {{players}} </p>
    <p> <b> Nickname: </b> {{nickname}} </p>

      <div id = "log" class = "log-area">
        <!--Log Messages will be added here -->
      </div>
    </div>

    <canvas id = "gameCanvas" style = "background-color:lightgray">Your browser does not support HTML5 Canvas</canvas>
    <script src = "{{ url_for('static', filename='board.js') }}"> </script>
    <script>
    console.log("connected");

    var socket = io.connect();

    //when you recieve a message append it to the log

    socket.on("update_board",function(msg) {
      if(msg.room == "{{join_code}}") {
        console.log("recieved: " + msg);
        boardPos = JSON.parse(msg.board);
        console.log(boardPos);
        draw_board();
      }
    });

    socket.on('message', function(msg) {
        if(msg.room == "{{join_code}}") {
          $('#log').append('<p>Received: ' + msg.data + '</p>');
        }
    });

    function change_team(teamToChange) {
      socket.emit('change_team', {team: teamToChange});
    }

    function endTurn() {
      socket.emit('end_turn');
    }

    function makeMove(iPos,jPos) {
      console.log("emit move " + iPos + " "+ jPos);
      socket.emit('make_move', {i:iPos,j:jPos});
    }

    function startGame() {
      console.log("emit");
      socket.emit('start_game');
    }
  </script>
  </body>
</html>
